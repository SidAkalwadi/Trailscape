(function(){"use strict";var e={487:function(e,t,n){var i=n(9242),o=n(3396),a=n(7139);const s={id:"app"},r=(0,o._)("div",{id:"unfocus"},null,-1),l=(0,o._)("img",{id:"display"},null,-1),c=(0,o._)("div",{id:"map"},null,-1),d=["onMouseenter"],m={key:0,class:"title",role:"textbox",contenteditable:""},g={key:1,class:"caption",role:"textbox",contenteditable:""},u={key:2,class:"titleText"},p={key:3,class:"captionText"},h=["disabled","value","onChange"],f=["onClick"],k=(0,o._)("div",{class:"dashed"},null,-1),y={key:2,id:"fileInput",type:"file",multiple:"multiple"};function w(e,t,n,i,w,v){return(0,o.wg)(),(0,o.iD)("div",s,[r,l,c,(0,o._)("div",{id:"captions",onScroll:t[0]||(t[0]=(...e)=>v.getScrollView&&v.getScrollView(...e))},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(w.markers,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.imgTitle+e.imgCaption+e.imgFilename+e.time.toString(),id:"container"},[(0,o._)("div",{class:"box",onMouseenter:t=>v.highlightPin(w.markers.indexOf(e))},[!0===w.editmode?((0,o.wg)(),(0,o.iD)("span",m,(0,a.zw)(e.imgTitle),1)):(0,o.kq)("",!0),!0===w.editmode?((0,o.wg)(),(0,o.iD)("span",g,(0,a.zw)(e.imgCaption),1)):(0,o.kq)("",!0),!1===w.editmode?((0,o.wg)(),(0,o.iD)("p",u,(0,a.zw)(e.imgTitle),1)):(0,o.kq)("",!0),!1===w.editmode?((0,o.wg)(),(0,o.iD)("p",p,(0,a.zw)(e.imgCaption),1)):(0,o.kq)("",!0),(0,o._)("input",{disabled:!1===w.editmode,type:"datetime-local",step:"1",class:"datePicker",value:v.formatDateTime(e.time),onChange:t=>{e.time=new Date(t.target.value),v.sortMarkers(!0)}},null,40,h),(0,o._)("button",{class:"viewButton",onClick:t=>v.viewImage(w.markers.indexOf(e))},"View Image",8,f)],40,d),k])))),128))],32),!0===w.editmode?((0,o.wg)(),(0,o.iD)("button",{key:0,id:"addButton",onClick:t[1]||(t[1]=(...e)=>v.addFile&&v.addFile(...e))},"Add images")):(0,o.kq)("",!0),!0===w.editmode?((0,o.wg)(),(0,o.iD)("button",{key:1,id:"saveButton",onClick:t[2]||(t[2]=(...e)=>v.sendFileData&&v.sendFileData(...e))},"Save")):(0,o.kq)("",!0),!0===w.editmode?((0,o.wg)(),(0,o.iD)("input",y)):(0,o.kq)("",!0)])}n(7658);var v=n(1528),S=n(862);const b=new v.aN({apiKey:"AIzaSyAZ0RCwDdcjyDHYcCAZgHihM2SsbXMsWzg",version:"weekly",libraries:["places"]}),C={zoom:17.5,mapId:"a4da5db6080b57fa",disableDefaultUI:!0,mapTypeId:"satellite",tilt:45};let D,I,T,L,O=0;const x="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z";let F,P=0;const M="https://us-central1-trailscape-send.cloudfunctions.net";var A={name:"App",mounted(){document.title="Trailscape";const e=new URLSearchParams(window.location.search);e.has("postId")&&(this.editmode=!1,console.log("loading data from post with id "+e.get("postId")),this.loadExisting(e.get("postId"))),this.editmode&&document.getElementById("fileInput").addEventListener("change",this.handleFileSelect,!1),document.getElementById("unfocus").addEventListener("click",(function(){document.getElementById("unfocus").style.display="none",document.getElementById("display").style.display="none"}),!1),b.load().then((e=>{I=e,D=new I.maps.Map(document.getElementById("map"),C),D.setCenter(new I.maps.LatLng(38.9907699,-77.5389951)),navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(e){D.setCenter(new I.maps.LatLng(e.coords.latitude,e.coords.longitude))})),F={path:x,anchor:new I.maps.Point(12,23),fillOpacity:1,strokeWeight:2,strokeColor:"#a62d29",scale:1.75,fillColor:"#db3e39"},T=new I.maps.DirectionsService,L=new I.maps.DirectionsRenderer({suppressMarkers:!0,polylineOptions:{strokeColor:"#0080db",strokeOpacity:1,strokeWeight:8}})})).catch((e=>{}))},methods:{addFile(){document.getElementById("fileInput").click(),document.getElementById("addButton").style.display="none"},finishLoading(){this.sortMarkers(!1),this.renderPath()},loadExisting(e){const t=this.markers,n=this.finishLoading;fetch(M+"/getData?postId="+e).then((function(e){return e.json()})).then((function(i){const o=t,a=n,s=i.captions,r=i.filenames,l=i.titles,c=i.times,d=i.coordinates;let m=0;for(let t=0;t<r.length;t++)fetch(M+"/getImage?filename="+e+"/"+r[t]).then((function(e){return e.text()})).then((function(e){const n=new I.maps.Marker({position:{lat:d[t].lat,lng:d[t].lng},map:D,draggable:!1,title:"Waypoint Pin",icon:F});o.push({marker:n,time:new Date(c[t]),imgSrc:e,imgFilename:"",imgTitle:l[t],imgCaption:s[t]}),m++,m===r.length&&a()}))}))},getHandleFileLoad(e){const t=this.renderPath,n=this.sortMarkers,i=this.markers;return function(o){const a=document.createElement("img");a.style.display="none",a.onload=function(){(0,S.getData)(a,(function(){const s=(0,S.getTag)(a,"GPSLongitude"),r=(0,S.getTag)(a,"GPSLongitudeRef"),l=(0,S.getTag)(a,"GPSLatitude"),c=(0,S.getTag)(a,"GPSLatitudeRef");let d=(0,S.getTag)(a,"DateTimeOriginal"),m=D.getCenter().lng(),g=D.getCenter().lat();try{m=parseFloat(s[0])+parseFloat(s[1])/60+parseFloat(s[2])/3600,"W"===r&&(m*=-1),g=parseFloat(l[0])+parseFloat(l[1])/60+parseFloat(l[2])/3600,"S"===c&&(g*=-1)}catch{console.log("error with coords, using "+g+", "+m),d="0000:00:00 00:00:00"}const u=new I.maps.Marker({position:{lat:g,lng:m},map:D,draggable:!0,title:"Waypoint Pin",icon:F});u.addListener("dragend",(()=>{t()}));const p=d.split(/\D/);i.push({marker:u,time:new Date(p[0],p[1]-1,p[2],p[3],p[4],p[5]),imgSrc:o.target.result,imgFilename:e,imgTitle:"",imgCaption:""}),i.length===O&&n(!1),a.remove()}))},a.src=o.target.result}},handleFileSelect(e){O=e.target.files.length;for(let t=0;t<e.target.files.length;t++){const n=new FileReader;n.onload=this.getHandleFileLoad(e.target.files[t].name),n.readAsDataURL(e.target.files[t])}},updateTitlesAndCaptions(){const e=document.getElementsByClassName("title"),t=document.getElementsByClassName("caption");for(let n=0;n<O;n++)this.markers[n].imgTitle=e[n].innerText,this.markers[n].imgCaption=t[n].innerText},sortMarkers(e){e&&this.updateTitlesAndCaptions(),this.markers.sort((function(e,t){return e.time-t.time})),console.log(this.markers),this.renderPath(),this.highlightPin(0)},renderPath(){if(this.markers.length<2)return;const e=[],t=new I.maps.LatLng(this.markers[0].marker.position.lat(),this.markers[0].marker.position.lng()),n=new I.maps.LatLng(this.markers[this.markers.length-1].marker.position.lat(),this.markers[this.markers.length-1].marker.position.lng());for(let o=1;o<this.markers.length-1;o++){const t={location:{lat:this.markers[o].marker.position.lat(),lng:this.markers[o].marker.position.lng()}};e.push(t)}const i={origin:t,destination:n,waypoints:e,travelMode:I.maps.TravelMode.WALKING};T.route(i,(function(e,t){"OK"===t?(L.setMap(D),L.setDirections(e)):(L.setMap(void 0),L.setDirections(void 0))}))},async sendFileData(){console.log("sending file data"),this.updateTitlesAndCaptions();const e={captions:[],coordinates:[],filenames:[],titles:[],timestamps:[]};for(let i=0;i<this.markers.length;i++){const t=this.markers[i];e.titles.push(t.imgTitle),e.captions.push(t.imgCaption),e.filenames.push(t.imgFilename),e.coordinates.push({lat:t.marker.position.lat(),lng:t.marker.position.lng()}),e.timestamps.push(t.time.toString())}console.log(e);let t="";await fetch(M+"/saveData",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){return console.log(e.status),e.text()})).then((function(e){t=e.split("/")[1],console.log(t)}));let n=0;for(let i=0;i<this.markers.length;i++){const e=this.markers[i],o=t+"/"+e.imgFilename,a=e.imgSrc;await fetch(M+"/uploadFile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filedata:a,filename:o})}).then((e=>e.text())).then((e=>{"OK"===e&&n++}))}n===this.markers.length&&alert("Successfully posted! You can now share using the following link:   https://trailscape-send.web.app/?postId="+t)},viewImage(e){document.getElementById("unfocus").style.display="block";const t=document.getElementById("display");t.style.display="inline",t.src=this.markers[e].imgSrc,t.onload=function(){const e=t.offsetWidth,n=t.offsetHeight;t.style.top="calc(50vh - "+n/2+"px)",t.style.left="calc(50vw - 230px - "+e/2+"px)"}},highlightPin(e){P=e;const t=JSON.parse(JSON.stringify(F));t.fillColor="#68f53d",t.strokeColor="#48ad2a";for(let n=0;n<this.markers.length;n++)if(e===n){this.markers[n].marker.setIcon(t),this.markers[n].marker.setAnimation(I.maps.Animation.BOUNCE);const e=this.markers[n].marker.getPosition();D.panTo(e)}else this.markers[n].marker.setIcon(F),this.markers[n].marker.setAnimation(null)},getScrollView(){const e=document.getElementsByClassName("box");for(let t=0;t<e.length;t++)if(e[t].getBoundingClientRect().bottom>80){t!==P&&this.highlightPin(t);break}},formatDateTime(e){const t=e.getFullYear().toLocaleString("en-US",{minimumIntegerDigits:4,useGrouping:!1}),n=(e.getMonth()+1).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),i=e.getDate().toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),o=e.getHours().toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),a=e.getMinutes().toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),s=e.getSeconds().toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1});return t+"-"+n+"-"+i+"T"+o+":"+a+":"+s}},data(){return{markers:[],editmode:!0}}},E=n(89);const B=(0,E.Z)(A,[["render",w]]);var G=B;(0,i.ri)(G).mount("#app")}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,n),a.exports}n.m=e,function(){var e=[];n.O=function(t,i,o,a){if(!i){var s=1/0;for(d=0;d<e.length;d++){i=e[d][0],o=e[d][1],a=e[d][2];for(var r=!0,l=0;l<i.length;l++)(!1&a||s>=a)&&Object.keys(n.O).every((function(e){return n.O[e](i[l])}))?i.splice(l--,1):(r=!1,a<s&&(s=a));if(r){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[i,o,a]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,i){var o,a,s=i[0],r=i[1],l=i[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(o in r)n.o(r,o)&&(n.m[o]=r[o]);if(l)var d=l(n)}for(t&&t(i);c<s.length;c++)a=s[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(d)},i=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=n.O(void 0,[998],(function(){return n(487)}));i=n.O(i)})();
//# sourceMappingURL=app.234e7eab.js.map